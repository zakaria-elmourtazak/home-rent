@{
    ViewData["Title"] = "Home Page";
}
@model  MyMvcAuthProject.Models.ListingProperty

<div class="container mx-auto px-4 py-8 flex flex-col md:flex-row gap-8">
    <!-- Sidebar -->
       @await Html.PartialAsync("_AccountSidebar" )

    <!-- Main Content -->
    <main class="flex-1">
        <div class="bg-white rounded-lg  shadow-sm p-6 mb-8" style="height: 700px;">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <div>
                    <h1 class="text-2xl text-primary font-bold mb-2">My Property Listings</h1>
                    <p class="text-gray-500">Manage your property listings</p>
                </div>
                <button id="add-property-btn"
                    class="mt-4 md:mt-0 bg-primary hover:bg-primary-dark button text-white px-4 py-3 rounded-lg transition flex items-center">
                    <i class="fas fa-plus mr-2"></i> New Property
                </button>
            </div>
@{
    // guard against null Model to avoid NullReferenceException
    var props = Model ?? new ListingProperty{ Properties = new List<MyMvcAuthProject.Models.Property>()};
}
            <!-- Properties Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white">
                    <thead>
                        <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-3 px-6 text-left">Property</th>
                            <th class="py-3 px-6 text-left">Type</th>
                            <th class="py-3 px-6 text-left">Price</th>
                            <th class="py-3 px-6 text-left">City</th>
                            <th class="py-3 px-6 text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-600 text-sm font-light">
      
                        @if (!props.Properties.Any())
                        {
                            <tr>
                                <td colspan="5" class="py-4 px-6 text-center text-gray-500">No properties found.</td>
                            </tr>
                        }
                        else
                        {
   @foreach (Property p in props.Properties)
                {
                                <tr class="border-b border-gray-200 hover:bg-gray-50">
                                    <td class="py-3 px-6 text-left whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="mr-4">
                                               @if (p.PropertyImages != null && p.PropertyImages.Any())
                                    {
                                        <img src="@p.PropertyImages.First().ImageUrl" alt="Property"
                                             class="w-16 h-16 rounded-lg object-cover" />
                                    }
                                    else
                                    {
                                        <div class="w-16 h-16 rounded-lg bg-gray-100 flex items-center justify-center text-gray-400">
                                            <i class="fas fa-image"></i>
                                        </div>
                                    }
                                            </div>
                                            <div class="font-medium">@p.Title</div>
                                        </div>
                                    </td>
                                    <td class="py-3 px-6 text-left">
                                        <span
                                            class="bg-gray-200 text-gray-900 text-xs px-2 py-1 rounded-full">@p.PropertyType</span>
                                    </td>
                                    <td class="py-3 px-6 text-left">$@p.PricePerMonth/mo</td>
                                    <td class="py-3 px-6 text-left">
                                        <span class="bg-green-100 text-primary text-xs px-2 py-1 rounded-full">@p.City</span>
                                    </td>
                                    <td class="py-3 px-6 text-center">
                                        <div class="flex item-center justify-center">
                                           <button type="button" class="edit-btn w-4 mr-4 transform hover:text-primary hover:scale-110" data-id="@p.Id">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-btn w-4 mr-4 transform hover:text-red-500 hover:scale-110" data-id="@p.Id">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                                <button class="view-btn w-4 transform hover:text-blue-500 hover:scale-110" data-id="@p.Id">
                                    <a asp-controller="Home" asp-action="PropertyDetail" asp-route-id="@p.Id"
                                   class="view-btn w-4 transform hover:text-blue-500 hover:scale-110">
                                    <i class="fas fa-eye"></i>
                                </a>
                                </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }

                       
                        </tbody>
                </table>
                <div class="mt-6 flex justify-between items-center">
                
                    @if (props.TotalCount > 0)
                    {
                        <p class="text-gray-600 text-sm cursor">Showing 1 to @props.TotalCount of @props.TotalCount entries</p>
                    }
                    @* <div class="flex space-x-2">
                        <button class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Previous</button>
                        <button class="px-4 py-2 bg-primary text-white rounded-lg">1</button>
                        <button class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">2</button>
                        <button class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">3</button>
                        <button class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Next</button>
                    </div> *@
                    <div class="flex space-x-2">
                        @if (props.CurrentPage > 1)
                        {
                            <a asp-action="AdminListings" asp-route-pageNumber="@(props.CurrentPage - 1)" class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200">Previous</a>
                        }
                        @for (int i = 1; i <= (int)Math.Ceiling((double)props.TotalCount / props.PageSize); i++)
                        {
                            if (i == props.CurrentPage)
                            {
                                <span class="px-4 py-2 bg-primary text-white rounded-lg button">@i</span>
                            }
                            else
                            {
                                <a asp-action="AdminListings" asp-route-pageNumber="@i" class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200">@i</a>
                            }
                        }
                        @if (props.CurrentPage < (int)Math.Ceiling((double)props.TotalCount / props.PageSize))
                        {
                            <a asp-action="AdminListings" asp-route-pageNumber="@(props.CurrentPage + 1)" class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200">Next</a>
                        }
                </div>
            </div>
        </div>
</div>
        <!-- Add/Edit Property Form (Hidden by default) -->
        <div id="property-form-container" class="bg-white rounded-lg  shadow-sm p-6 hidden">
            <h2 id="form-title" class="text-2xl font-bold   mb-2">Add New Property</h2>
               <p class="text-gray-500 mb-6">Property Information</p>
           <form asp-controller="Property" asp-action="Create" method="post" id="property-form" class="space-y-8" enctype="multipart/form-data">
                @Html.AntiForgeryToken()
                <input type="hidden" id="property-id" name="Id" value="">

                <!-- Property Information -->
                <div >
                    @* <p class="text-sm font-bold mb-4 text-gray-500 mt-0 pt-0"> Property Information</p> *@
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 font-medium mb-2">Property Title</label>
                            <input type="text" id="property-title" name="Title"
                                placeholder="e.g. Modern Apartment Downtown" class="w-full p-3 border rounded-lg input"
                                required>
                        </div>
                                                    
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 font-medium mb-2">Description</label>
                                        <textarea id="property-description" name="Description" placeholder="Describe your property in detail..." class="input w-full p-3 border rounded-lg h-32" required></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Property Type</label>
                                        <select id="property-type" name="PropertyType" class="input w-full p-3 border rounded-lg" required>
                                    <option value="">Select Property Type</option>
                                    <option value="Apartment">Apartment</option>
                                    <option value="House">House</option>
                                    <option value="Condo">Condo</option>
                                    <option value="Studio">Studio</option>
                                    <option value="Townhouse">Townhouse</option>
                                    <option value="Loft">Loft</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Price per Month ($)</label>
                                        <input type="number" id="property-price" name="PricePerMonth" step="0.01" placeholder="e.g. 1200" class="input w-full p-3 border rounded-lg" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Bedrooms</label>
                                        <select id="property-bedrooms" name="Bedrooms" class="input w-full p-3 border rounded-lg" required>
                                    <option value="">Select</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Bathrooms</label>
                                        <select id="property-bathrooms" name="Bathrooms" class="input w-full p-3 border rounded-lg" required>
                                    <option value="">Select</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Square Feet</label>
                                        <input type="number" id="property-sqft" name="SquareFeet" placeholder="e.g. 900" class="input w-full p-3 border rounded-lg" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Available Date</label>
                                        <input type="date" id="property-date" name="AvailableDate" class="input w-full p-3 border rounded-lg" required>
                            </div>
                        </div>
                </div>
                                    
                    <!-- Address -->
                    <div>
                        <h2 class="text-xl font-bold mb-4">Address</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 font-medium mb-2">Street Address</label>
                                <input type="text" id="property-street" name="StreetAddress" placeholder="e.g. 123 Main Street" class="input w-full p-3 border rounded-lg" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">City</label>
                                <input type="text" id="property-city" name="City" placeholder="e.g. New York" class="input w-full p-3 border rounded-lg" required>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Region</label>
                                <select id="property-state" name="State" class="input w-full p-3 border rounded-lg" required>
                                    <option value="">Select a region</option>
  <option value="Tanger-Tetouan-Al Hoceima">Tanger-Tétouan-Al Hoceïma</option>
  <option value="Oriental">L’Oriental</option>
  <option value="Fes-Meknes">Fès-Meknès</option>
  <option value="Rabat-Sale-Kenitra">Rabat-Salé-Kénitra</option>
  <option value="Beni Mellal-Khenifra">Béni Mellal-Khénifra</option>
  <option value="Casablanca-Settat">Casablanca-Settat</option>
  <option value="Marrakech-Safi">Marrakech-Safi</option>
  <option value="Draa-Tafilalet">Drâa-Tafilalet</option>
  <option value="Souss-Massa">Souss-Massa</option>
  <option value="Guelmim-Oued Noun">Guelmim-Oued Noun</option>
  <option value="Laayoune-Sakia El Hamra">Laâyoune-Sakia El Hamra</option>
  <option value="Dakhla-Oued Ed-Dahab">Dakhla-Oued Ed-Dahab</option>

                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">ZIP Code</label>
                                <input type="text" id="property-zip" name="ZipCode" placeholder="e.g. 10001" class="input w-full p-3 border rounded-lg" required>
                            </div>
                            
                            @* <div>
                            <label class="block text-gray-700 font-medium mb-2">Country</label>
                                <input type="text" id="property-country" name="Country" value="Morocco" class="input w-full p-3 border rounded-lg bg-gray-100" >
                            </div> *@
                        </div>
                    </div>
                    
                   
    <div>
        <h2 class="text-xl font-bold mb-4">Property Images</h2>
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
            <p class="text-gray-600 mb-4">Drag & drop images here or click to browse</p>
            <input type="file" id="image-upload" name="PropertyImages" class="hidden" accept="image/*" multiple>
            <button type="button" class="button bg-primary hover:bg-secondary text-white px-6 py-2 rounded-lg transition" onclick="document.getElementById('image-upload').click()">
                Select Images
            </button>
            <p class="text-gray-500 text-sm mt-2">Maximum file size: 5MB. Supported formats: JPG, PNG, GIF</p>
        </div>
        
        <div id="image-preview" class="image-preview mt-4"></div>
    </div>
                    
                    <!-- Form Actions -->
                <div class="flex justify-end space-x-4 pt-6">
                    <button type="button" id="cancel-btn"
                        class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition white-button">
                        Cancel
                    </button>
                    <button type="submit"
                        class="bg-primary button text-white px-6 py-3 rounded-lg transition font-semibold button">
                        <i class="fas fa-save mr-2"></i> Save Property
                    </button>
                </div>
            </form>
        </div>
    </main>
</div>